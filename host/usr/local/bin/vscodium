#!/bin/bash

podman run \
    --rm \
    --interactive \
    --tty \
    --user $UID:$UID \
    --hostuser $UID \
    --userns keep-id \
    --group-add keep-groups \
    --security-opt label=disable \
    --shm-size 0 \
    --env COLORTERM=truecolor \
    --env TERM=xterm-256color \
    --env HOME=$HOME \
    --env WAYLAND_DISPLAY=${WAYLAND_DISPLAY:-wayland-0} \
    --env DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$UID/bus \
    --env XDG_CURRENT_DESKTOP=${XDG_CURRENT_DESKTOP:-GNOME} \
    --env XDG_SESSION_DESKTOP=${XDG_SESSION_DESKTOP:-gnome} \
    --env XDG_RUNTIME_DIR=/run/user/$UID \
    --env XDG_SESSION_CLASS=user \
    --env XDG_SESSION_TYPE=wayland \
    --env ELECTRON_OZONE_PLATFORM_HINT=wayland \
    --env CONTAINER_HOST=unix:///run/user/$UID/podman/podman.sock \
    --device /dev/dri \
    --volume /run/user/$UID:/run/user/$UID \
    --volume /run/dbus/system_bus_socket:/run/dbus/system_bus_socket \
    --volume $HOME:$HOME \
    localhost/vscodium:${TAG:-latest} \
    "$@"
