#!/bin/bash

# Import user environment
eval "$(systemctl --user show-environment | sed 's/^/export /')"

# shellcheck disable=SC2046
podman run \
    --rm \
    --interactive \
    --tty \
    --user $USER \
    --hostuser $UID \
    --userns keep-id \
    --group-add keep-groups \
    --security-opt label=disable \
    --network host \
    --shm-size 0 \
    --device /dev/dri:/dev/dri \
    --env HOME=$HOME \
    --env WAYLAND_DISPLAY=${WAYLAND_DISPLAY:-wayland-0} \
    --env DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$UID/bus \
    --env XDG_RUNTIME_DIR=/run/user/$UID \
    --volume /run/user/$UID:/run/user/$UID \
    --volume /run/dbus/system_bus_socket:/run/dbus/system_bus_socket \
    --volume $HOME:$HOME \
    localhost/vscodium:${TAG:-latest} \
    /usr/bin/codium --verbose --ozone-platform=wayland "$@"
